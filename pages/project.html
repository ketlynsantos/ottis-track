<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OTIS-TRACK — Projeto</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="icon" href="/img/favicon.svg" type="image/svg+xml" />
  </head>
  <body>
    <header class="header">
      <div class="nav">
        <a class="nav__brand" href="/index.html">
          <img src="/img/otis-track-logo-horizontal.svg" alt="Logo Otis Track" />
        </a>
        <nav class="nav__menu">
          <a href="/index.html" class="nav__item">Home</a>
          <a href="dashboard.html" class="nav__item">Dashboard</a>
          <a href="projects.html" class="nav__item">Projetos</a>
          <a href="client-portal.html" class="nav__item">Portal do Cliente</a>
        </nav>
        <div class="nav__search"><input placeholder="Buscar no projeto..." /></div>
      </div>
    </header>
    <div class="container" id="project">
      <div class="two-col">
        <div class="project__main">
          <h2 class="project__title" id="p-title">Projeto</h2>
          <div class="project__status" style="margin: 8px 0 16px 0">
            <span class="badge" id="p-stage">Status</span>
          </div>
          <div class="kpi-strip">
            <div class="kpi">
              <h3>No prazo</h3>
              <div class="kpi__value" id="p-ot">—</div>
            </div>
            <div class="kpi">
              <h3>Tempo de ciclo</h3>
              <div class="kpi__value" id="p-lt">—</div>
            </div>
            <div class="kpi">
              <h3>Variação de custo</h3>
              <div class="kpi__value" id="p-cv">—</div>
            </div>
            <div class="kpi">
              <h3>Primeiro passe (FPY)</h3>
              <div class="kpi__value" id="p-fpy">—</div>
            </div>
          </div>
          <div class="tabs" role="tablist">
            <button class="tab tab--active" data-tab="geral" onclick="AppProject.tabTo('geral')">
              Visão Geral
            </button>
            <button class="tab" data-tab="marcos" onclick="AppProject.tabTo('marcos')">Marcos</button>
            <button class="tab" data-tab="custos" onclick="AppProject.tabTo('custos')">Custos</button>
            <button class="tab" data-tab="qualidade" onclick="AppProject.tabTo('qualidade')">
              Qualidade
            </button>
            <button class="tab" data-tab="anexos" onclick="AppProject.tabTo('anexos')">Anexos</button>
          </div>
          <div id="panel-geral" class="tabpanel" style="display: block">
            <div class="card">
              <strong>Resumo</strong>
              <p class="small">Principais indicadores e riscos do projeto.</p>
              <div style="margin-top:8px"><strong>Insights</strong></div>
              <div id="insights" class="vprops"></div>
            </div>
          </div>
          <div id="panel-marcos" class="tabpanel" style="display: none">
            <div class="card">
              <strong>Linha do tempo</strong>
              <div id="timeline" class="timeline" style="margin-top: 12px"></div>
            </div>
          </div>
          <div id="panel-custos" class="tabpanel" style="display: none">
            <div class="card">
              <strong>Orçado × Realizado</strong>
              <div class="small" id="cost-line">—</div>
              <div class="statbar" id="cost-bar" style="margin-top: 8px">
                <div class="fill" style="width: 40%"></div>
              </div>
              <div class="small" id="cost-delta" style="margin-top: 6px">—</div>
            </div>
          </div>
          <div id="panel-qualidade" class="tabpanel" style="display: none">
            <div id="quality" class="grid"></div>
            <div style="margin-top: 8px">
              <button class="btn btn--primary" onclick="AppProject.openModal()">+ Nova NC</button>
            </div>
          </div>
          <div id="panel-anexos" class="tabpanel" style="display: none">
            <div class="card">Sem anexos no MVP.</div>
          </div>
        </div>
        <aside>
          <div class="card">
            <strong>Filtros rápidos</strong>
            <div class="filters">
              <div class="filters__item">
                <label class="filters__label">País</label>
                <select class="filters__select">
                  <option>Todos</option>
                  <option>Brasil</option>
                  <option>Chile</option>
                  <option>Argentina</option>
                </select>
              </div>
              <div class="filters__item">
                <label class="filters__label">Etapa</label>
                <select class="filters__select">
                  <option>Todas</option>
                  <option>Fabricação</option>
                  <option>Instalação</option>
                  <option>Testes</option>
                </select>
              </div>
            </div>
            <a class="btn btn--block" href="projects.html">Voltar à lista</a>
          </div>
          <div class="card">
            <strong>Portal do Cliente</strong>
            <p class="small">Compartilhe status e colete feedback.</p>
            <a class="btn" href="#" id="portal-link">Abrir Portal</a>
          </div>
        </aside>
      </div>
    </div>

    <!-- Modal Nova Não Conformidade-->
    <dialog id="nc-dialog" role="dialog" aria-labelledby="nc-title" class="modal">
      <div class="modal__header">
        <h3 id="nc-title" class="modal__title">Nova Não Conformidade</h3>
      </div>
      <div class="modal__body">
        <form id="nc-form" onsubmit="event.preventDefault(); AppProject.closeModal();">
          <div class="modal__field">
            <label>Título*</label>
            <input required type="text" />
          </div>
          <div class="modal__field">
            <label>Tipo</label>
            <select>
              <option>Processo</option>
              <option>Material</option>
              <option>Execução</option>
            </select>
          </div>
          <div class="modal__field">
            <label>Gravidade</label>
            <select>
              <option>Baixa</option>
              <option>Média</option>
              <option>Alta</option>
            </select>
          </div>
          <div class="modal__field"><label>Descrição</label><textarea></textarea></div>
          <div class="modal__field"><label>Responsável</label><input type="text" /></div>
          <div class="modal__field"><label>Data limite</label><input type="date" /></div>
          <div class="modal__actions">
            <button class="btn" type="button" onclick="AppProject.closeModal()">Cancelar</button>
            <button class="btn btn--primary" type="submit">Salvar</button>
          </div>
        </form>
      </div>
    </dialog>
    <div class="toast"></div>
    <footer class="footer">
      © 2025 OTIS-TRACK — MVP · Trabalho de faculdade da FIAP (Challenge 2025)
    </footer>
    <script src="/js/data.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/project.js"></script>
    <script>
      const params = new URLSearchParams(location.search);
      const id = params.get('id') || 'BR-5510';
      const p = AppProject.getProject(id);
      AppProject.renderProject(p);
      const pl = document.getElementById('portal-link');
      if (p) {
        pl.href = 'client-portal.html?id=' + encodeURIComponent(p.id);
      }
    </script>
  </body>
</html>
